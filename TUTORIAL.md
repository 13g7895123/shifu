# luckygo 系統操作教學文件

## 📖 目錄

1. [系統概述](#系統概述)
2. [環境啟動](#環境啟動)
3. [用戶管理](#用戶管理)
4. [遊戲系統](#遊戲系統)
5. [獎勵管理](#獎勵管理)
6. [出貨管理](#出貨管理)
7. [聊天室功能](#聊天室功能)
8. [故障排除](#故障排除)

---

## 系統概述

luckygo 是一個基於 Clean Architecture 設計的現代化網頁應用程式，提供遊戲管理、用戶管理、獎勵系統等完整功能。系統採用前後端分離架構，使用 React + TypeScript 前端和 Express.js + TypeScript 後端。

### 主要功能模組
- **用戶管理**: 用戶註冊、登入、資料管理
- **遊戲系統**: 遊戲建立、票券購買、進度管理
- **獎勵系統**: 獎勵發放、狀態追蹤
- **出貨管理**: 實體獎品出貨流程管理
- **即時聊天**: 遊戲內聊天室功能

---

## 環境啟動

### 🚀 快速啟動（推薦）

使用 Docker 快速啟動完整環境：

```powershell
# 啟動開發環境（含熱重載）
.\docker-scripts.bat dev:up

# 查看服務狀態
.\docker-scripts.bat status

# 查看即時日誌
.\docker-scripts.bat dev:logs

# 停止服務
.\docker-scripts.bat dev:down
```

### 🌐 訪問地址
- **主應用程式**: http://localhost:3000
- **Redis 管理界面**: http://localhost:8081

### 📋 可用的 Docker 指令

| 指令 | 功能 | 說明 |
|------|------|------|
| `.\docker-scripts.bat dev:up` | 啟動開發環境 | 含熱重載功能，適合開發使用 |
| `.\docker-scripts.bat dev:down` | 停止開發環境 | 停止所有開發容器 |
| `.\docker-scripts.bat prod:up` | 啟動生產環境 | 生產環境模式，不含開發工具 |
| `.\docker-scripts.bat prod:nginx` | 啟動生產環境（含 Nginx） | 包含反向代理的完整生產環境 |
| `.\docker-scripts.bat build` | 重新建構映像檔 | 更新代碼後需要重建 |
| `.\docker-scripts.bat clean` | 清理 Docker 資源 | 刪除所有容器和映像檔 |
| `.\docker-scripts.bat backup` | 備份 Redis 資料 | 備份系統資料 |
| `.\docker-scripts.bat status` | 查看服務狀態 | 顯示所有服務運行狀況 |

---

## 用戶管理

### 👤 用戶角色

系統支援兩種用戶角色：
- **玩家 (player)**: 可以參與遊戲、購買票券、查看獎勞
- **管理員 (admin)**: 擁有所有權限，可以管理用戶、遊戲、獎勵

### 🔐 用戶註冊與登入

#### 新用戶註冊
1. 訪問 http://localhost:3000
2. 點擊「註冊」按鈕
3. 填寫以下資訊：
   - 姓名
   - 電子郵件
   - 密碼
   - 電話號碼
   - 地址（用於實體獎品配送）
4. 點擊「註冊」完成

#### 用戶登入
1. 在首頁點擊「登入」
2. 輸入電子郵件和密碼
3. 點擊「登入」

### 👥 管理員用戶管理

管理員可以在「管理員控制台」> 「用戶管理」進行以下操作：

#### 查看用戶列表
- **統計資訊**: 顯示總用戶數、管理員數、玩家數、總願望幣
- **搜尋功能**: 可依姓名、電子郵件、電話、角色搜尋
- **用戶資訊**: 查看用戶基本資料和帳戶狀態

#### 管理用戶詳細資料
1. 點擊用戶列表中的「👁」查看按鈕
2. 在用戶詳細資料對話框中可以：
   - **編輯基本資料**: 修改姓名、電話、地址
   - **調整角色**: 變更用戶為管理員或玩家
   - **管理願望幣**: 增加或減少用戶願望幣
   - **查看獎勵記錄**: 檢視用戶獲得的所有獎勵

#### 願望幣管理
- 輸入願望幣數量（正數為增加，負數為減少）
- 填寫操作原因
- 點擊「更新願望幣」確認

---

## 遊戲系統

### 🎮 遊戲管理（管理員）

管理員可以在「遊戲管理」頁面進行以下操作：

#### 建立新遊戲
1. 點擊「+ 建立新遊戲」
2. 填寫遊戲資訊：
   - **遊戲 ID**: 唯一識別碼
   - **遊戲標題**: 顯示名稱
   - **遊戲描述**: 詳細說明
   - **票券數量**: 總票券數（預設 100）
   - **票券價格**: 每張票券的願望幣價格（預設 10）
3. 點擊「建立遊戲」

#### 遊戲狀態管理
遊戲有以下狀態：
- **待開始 (pending)**: 剛建立，尚未開始
- **進行中 (active)**: 可購買票券、發放獎勵
- **已結束 (finished)**: 遊戲結束
- **已取消 (canceled)**: 遊戲取消

#### 遊戲操作
| 操作 | 條件 | 功能 |
|------|------|------|
| ▶️ 開始遊戲 | 待開始狀態 | 啟動遊戲，開放票券購買 |
| ⏸️ 結束遊戲 | 進行中狀態 | 結束遊戲，停止所有活動 |
| 🚫 停止購買 | 進行中且未停止購買 | 禁止購買新票券 |
| ▶️ 恢復購買 | 進行中且已停止購買 | 重新開放票券購買 |
| 🎁 發禮物 | 進行中狀態 | 發放獎勵給指定票券 |
| ✏️ 編輯 | 待開始或已結束 | 修改遊戲設定 |
| 🗑️ 刪除 | 待開始或已結束 | 刪除遊戲 |

### 🎲 參與遊戲（玩家）

#### 查看進行中的遊戲
1. 導航至「遊戲」頁面
2. 如果有進行中的遊戲，會看到：
   - 遊戲影片播放器
   - 右側滑動面板（點擊箭頭開關）
   - 即時聊天室

#### 購買票券
1. 點擊右側箭頭打開遊戲面板
2. 在票券格子中選擇未購買的票券（灰色）
3. 確認購買（會扣除對應願望幣）
4. 購買成功後票券變為藍色，顯示你的名字

#### 票券狀態說明
- **灰色**: 未購買，可點擊購買
- **藍色**: 已由你購買
- **綠色**: 已有獎勵的票券
- **其他顏色**: 其他玩家購買的票券

---

## 獎勵管理

### 🏆 獎勵類型

系統支援兩種獎勵類型：
- **願望幣獎勵 (points)**: 直接加到用戶帳戶
- **實體獎勵 (physical)**: 需要出貨的實體物品

### 🎁 發放獎勵（管理員）

#### 在遊戲管理中發放
1. 在進行中的遊戲點擊「🎁 發禮物」
2. 填寫獎勵資訊：
   - **票號**: 指定獲獎的票券號碼
   - **獎勵類型**: 選擇願望幣或實體獎勵
   - **獎勵內容**: 
     - 願望幣獎勵：輸入願望幣數量（如：100）
     - 實體獎勵：輸入物品描述（如：限量版T恤）
3. 點擊「發送禮物」

#### 查看遊戲獎勵
- 在遊戲面板的「遊戲獎勵列表」中查看
- 顯示所有已發放的獎勵及其狀態

### 🎖️ 查看個人獎勵（玩家）

#### 我的獎勵頁面
1. 導航至「我的獎勵」
2. 查看獲得的所有獎勵：
   - 獎勵內容和類型
   - 獲獎遊戲和票券號碼
   - 獲獎時間
   - 出貨狀態（實體獎勵）

#### 申請出貨通知
對於待出貨的實體獎勵：
1. 點擊「申請出貨通知」
2. 系統會通知管理員準備出貨
3. 狀態變更為「已通知出貨」

---

## 出貨管理

### 📦 出貨管理（管理員）

管理員在「出貨管理」頁面可以：

#### 查看出貨統計
- **待出貨**: 需要處理的實體獎勵數量
- **已通知出貨**: 已收到出貨申請的獎勵數量
- **已出貨**: 已完成出貨的獎勵數量
- **總計**: 所有實體獎勵總數

#### 管理用戶獎勵
1. **按用戶分組**: 獎勵按用戶分組顯示
2. **查看用戶資訊**: 包含收件地址
3. **批次處理**: 可同時處理同一用戶的多個獎勵

#### 出貨狀態操作
| 狀態 | 操作 | 說明 |
|------|------|------|
| 待出貨 | 通知出貨 | 變更為「已通知出貨」 |
| 已通知出貨 | 標記已出貨 | 完成出貨流程 |
| 已出貨 | 無操作 | 出貨完成 |

### 📊 出貨流程

1. **用戶獲得實體獎勵** → 狀態：待出貨
2. **用戶申請出貨通知** → 狀態：已通知出貨
3. **管理員準備並出貨** → 狀態：已出貨

---

## 聊天室功能

### 💬 即時聊天

#### 功能特色
- **即時通訊**: WebSocket 技術實現即時聊天
- **遊戲整合**: 在遊戲頁面右下角固定顯示
- **用戶識別**: 顯示發言者姓名和身分

#### 使用聊天室
1. 在遊戲頁面，聊天室會自動出現在右下角
2. 在輸入框輸入訊息
3. 按 Enter 或點擊發送按鈕
4. 訊息會即時顯示給所有在線用戶

#### 聊天室狀態
- **連線中**: 顯示綠色狀態指示
- **斷線**: 顯示紅色狀態，會自動重連
- **訊息記錄**: 顯示最近的聊天記錄

---

## 故障排除

### 🔧 常見問題與解決方案

#### 1. 應用程式無法啟動
```powershell
# 檢查 Docker 服務狀態
.\docker-scripts.bat status

# 重新建構並啟動
.\docker-scripts.bat build
.\docker-scripts.bat dev:up
```

#### 2. 前端修改未生效
開發環境已配置熱重載，前端修改會自動反映。如果未生效：
```powershell
# 重啟開發環境
.\docker-scripts.bat dev:down
.\docker-scripts.bat dev:up
```

#### 3. 後端修改未生效
後端也配置了熱重載，修改後會自動重啟。如果問題持續：
```powershell
# 查看後端日誌
.\docker-scripts.bat dev:logs
```

#### 4. 資料遺失
```powershell
# 恢復 Redis 資料備份
.\docker-scripts.bat backup
```

#### 5. 登入問題
- 確認用戶資料正確
- 檢查瀏覽器 Cookie 設定
- 嘗試清除瀏覽器快取

#### 6. 聊天室連線問題
- 檢查網路連線
- 重新整理頁面
- 確認 WebSocket 連接正常

### 🔍 調試技巧

#### 查看應用程式日誌
```powershell
# 查看所有服務日誌
.\docker-scripts.bat dev:logs

# 只查看特定服務
docker logs luckygo-frontend-dev
docker logs luckygo-backend-dev
docker logs luckygo-redis-dev
```

#### 進入容器內部調試
```powershell
# 進入後端容器
docker exec -it luckygo-backend-dev /bin/bash

# 進入前端容器  
docker exec -it luckygo-frontend-dev /bin/bash
```

#### 檢查資料庫狀態
訪問 Redis Commander: http://localhost:8081

### 📞 技術支援

如遇到其他問題：
1. 檢查控制台錯誤訊息
2. 查看應用程式日誌
3. 參考 README.md 文件
4. 確認環境配置正確

---

## 🎯 最佳實務建議

### 系統管理
1. **定期備份**: 使用 `.\docker-scripts.bat backup` 備份重要資料
2. **監控日誌**: 定期查看系統日誌，及早發現問題
3. **環境隔離**: 開發和生產環境使用不同的配置

### 遊戲運營
1. **遊戲規劃**: 提前規劃遊戲內容和獎勵
2. **即時監控**: 遊戲進行中密切關注參與度
3. **公平發獎**: 確保獎勵發放的公平性和透明度

### 用戶體驗
1. **清楚說明**: 提供清楚的遊戲規則說明
2. **即時回饋**: 對用戶操作提供即時回饋
3. **問題處理**: 快速回應用戶問題和建議

---

## 📚 相關文件

- [README.md](./README.md) - 基本安裝和設定
- [README_NEW_ARCHITECTURE.md](./README_NEW_ARCHITECTURE.md) - 架構說明
- [HOT_RELOAD_TEST.md](./HOT_RELOAD_TEST.md) - 熱重載測試
- [MOBILE_OPTIMIZATION_SUMMARY.md](./MOBILE_OPTIMIZATION_SUMMARY.md) - 行動裝置優化

---

*最後更新：2024年12月 | luckygo 系統操作教學 v1.0*
